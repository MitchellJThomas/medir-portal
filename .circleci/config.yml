---
version: 2
jobs:

  UI-Build:
    docker:
      - image: circleci/node:latest
    steps:
      - setup_remote_docker
      - checkout
      - run:
          name: Node Version
          command: |
            node -v
      - run:
          name: Yarn it
          working_directory: ui/medir-ui
          command: |
            yarn install
            yarn build
      - run:
          working_directory:  web-portal
          name: Remote build of webserver
          command: |
            mv ../ui/medir-ui/build/ ./public/
            TAG=0.2.$CIRCLE_BUILD_NUM
            docker login -u $DOCKER_USER -p $DOCKER_PASS
            echo "Building medir-portal:$TAG"
            docker build -t mitchelljthomas/medir-portal:$TAG .
            docker push mitchelljthomas/medir-portal:$TAG
